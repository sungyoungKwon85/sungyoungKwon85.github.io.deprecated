# book-microservice-pattern
`마이크로서비스 패턴, 길벗` 도서 요약 정리입니다.   
`FTGO`라는 `음식배달` 서비스를 예제로 합니다.    
기존에는 `WAR`파일로 구성된 `모놀리스`로 개발되었으나 서비스가 커지면서 많은 문제가 발생합니다.  



#
## 1. 개요
#### 모놀리스 장점
- IDE 등 개발툴이 모놀리스에 맞춰져 있어 개발이 간단하다
- 코드, DB스키마 등 변경해서 빌드/배포하기 쉽다
- 테스트하기 쉽다
- 배포하기 쉽다
- 인스턴스를 늘리는 등 확장이 쉽다



#### 서비스가 커져버린 모놀리스 단점
- 개발자가 이해하기에 너무 복잡하다
- 개발이 더뎌진다
- CI/CD 유지가히가 어렵다
- 확장하기 어렵다
- 기술 스택에 발목 잡힌다
- 어떤 모듈 하나에 버그 하나만 있어도 전체 시스템에 영향 받는다



#  
`FTGO`팀은 `Microservice Articheture`로 전환하기로 합니다.   

#
#### Microservice Architecture 장점
- 느슨한 결합에 따른 테스트성, 배포성, 자율성 등이 오른다. CI/CD 할 수 있다.
- 서비스가 작아 관리하기 용이하다. 
- 서비스마다 독립적으로 배포/확장가능하다.
- 결함 격리가 쉽다.
- 신기술 도입/시험 쉽다.
  

#### Micoriservice Architecture 단점
- 딱 맞게 서비스 분해하기 어렵다
- 분산 시스템은 복잡하다. 
- 공통 기능 관리
- 도입시기를 언제로 할지 애매하다.

  

#
#### 패턴
- 분해 패턴(2장)
- 통신 패턴(3장, 8장)
- 트랜잭션을 위한 일관성 패턴(4~6장)
- 데이터쿼리 패턴(7장)
- 서비스 배포 패턴(12장)
- 관측성 패턴(11장)
- 서비스 테스트 자동화 패턴(9, 10장)
- 횡단 관심사 처리 패턴(11장)
- 보안 패턴(11장)



#
## 2. 분해 전략

- 마이크로서비스는 기술적 관심사보다 비즈니스 능력, 하위 도메인 등 비즈니스 관심사 위주로 구성된다.  
- 서비스를 분해하는 패턴은 비즈니스 능력에 따른 분해, 하위 도메인에 따른 분해(DDD) 등이 있다.  
- DDD를 적용하고 서비스마다 도메인 모델을 따로 설계하면, 의존 관계가 뒤엉켜 분해를 가로막는 만등 클래스를 제거할 수 있다.  

#
#### 마이크로서비스?
- 마이크로서비스 아키텍쳐의 핵심 제약조건은 서비스를 느슨하게 결합한다는 것이다.  
- 서비스는 단독 배포가 가능한 소프트웨어 컴포넌트이다.  
- 클라이언트가 서비스하는 기능에 접근할 수 있도록 커맨드, 쿼리, 이벤트로 구성된 API를 제공한다.  
(ex: 커멘드는 업테이트하고 쿼리는 조회한다.)  
- 서비스 API는 내부 구현을 캡슐화하여 모듈성을 보장한다.  
- 이는 유지보수성, 테스트성을 높이고 개발시간 또한 단축시킨다.  
- 서비스는 DB테이블을 서로 공유하지 않으므로 런타임 격리도 향상된다.  
(일관성은 더 복잡해진다.)  
- 공유 라이브러리는 결합도를 유발하지 않도록 조심해야 한다.  


#
#### 정의
- 도메인 전문가가 문서로 정리한 요건들과 기존 애플리케이션을 출발점으로
- 1단계, 애플리케이션 요건을 핵심 요청으로 추출
- 2단계, 어떻게 여러 서비스로 분해할지 결정 by DDD or 비즈니스 아키텍쳐
- 3단계, 서비스별로 API정의


#
## 3. 프로세스 간 통신
- 마이크로서비스 아키텐트는 여러 개의 서비스로 구성하며 서비스 인스턴스는 여러 머신에서 실행되는 프로세스 형태이므로 반드시 IPC를 통해 상호 작용해야 한다.  
(IPC: 프로세스간 통신)  
- IPC기술은 JSON을 주고받는 REST가 대세이지만 메시징 등 다양한 IPC 옵션을 고려해야 한다. 


#
##### 클라이언트/서비스 상호 작용 스타일 분류
- 일대다 여부
  - one to one: 각 요청을 한 서비스가 처리
  - one to many: 각 요청을 여러 서비스가 협동하여 처리    

- 비동기 여부  
  - synchronous: 클라이언트는 서비스가 제시간에 응답하리라 기대하고 블로킹할 수 있음
  - asynchronous: 응답은 즉시 전동되지 않아도 됨, 블로킹 하지 않음

- 일대일 상호 작용 종류
  - 요청/응답
  - 비동기 요청/응답
  - 단방향 알림

- 일대다 상호 작용 종류
  - 발행/구독
  - 발행/비동기 응답



 






















 




